# 稀疏梅克爾樹／前綴梅克爾樹比較實驗

## 前綴 + 索引

在原本的前綴樹的結構上，再加入一個 key-value 的索引，使得給一個 key ，能夠僅使用一次存取就得到 value 。

### 如何維護索引？

### 無索引 vs 有索引

- 插入：有索引的多一次插入
- 查找：有索引的只需要一次查詢

## aergo 稀疏



## 前提

試計算 aergo 稀疏、前綴樹在隨機插入之下， n 個 key 的平均深度。

先假設爲 log(n)。

## 比較表

### 插入即更新 root

假設所有數據儲存於記憶體，每次 hash 存取，耗時 h

當前葉子數量爲 n

樸素稀疏的深度爲 d

|      | 樸素稀疏 | aergo 稀疏 | 前綴       | 前綴+索引  |
| ---- | -------- | ---------- | ---------- | ---------- |
| 插入 | d * h    | log(n) * h | log(n) * h | log(n) * h |
| 查找 | h        | h          | log(n) * h | h          |
| root | 0        | 0          | 0          | 0          |

假設數據從硬碟載入，每次從 key-value 存取，耗時 h

當前葉子數量爲 n

|      | 樸素稀疏 | aergo 稀疏 | 前綴 |
| ---- | -------- | ---------- | ---- |
| 插入 |          |            |      |
| 查找 |          |            |      |
| root |          |            |      |
|      |          |            |      |

### 批量更新

假設所有數據儲存於記憶體，每次 hash 存取，耗時 h 

當前葉子數量爲 n

|      | 樸素稀疏 | aergo 稀疏 | 前綴 |
| ---- | -------- | ---------- | ---- |
| 插入 | h        |            |      |
| 查找 | h        |            |      |
| root |          |            |      |

假設數據從硬碟載入，每次從 key-value 存取，耗時 h

當前葉子數量爲 n

|      | 樸素稀疏 | aergo 稀疏 | 前綴 |
| ---- | -------- | ---------- | ---- |
| 插入 |          |            |      |
| 查找 |          |            |      |
| root |          |            |      |
|      |          |            |      |

## 

## 稀疏樹的優勢

